<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <script src="{{url_for('static', filename='d3.js')}}"></script>


  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/downloadjs/1.4.8/download.min.js"></script>
  <title>Oblicz WPS</title>
  <style>
    .top-buffer {
      margin-top: 20px;
    }

    span {

      font-size: large;
    }

    path {
      fill: none;
      stroke-width: 1px;
      stroke: black;
    }

    path.kreska {
      fill: none;
      stroke-width: 2px;
      stroke: black;
    }

    path.kreska2 {
      fill: none;
      stroke-width: 2px;
      stroke: rgb(61, 83, 53);
      border-style: dotted;
      stroke-dasharray: 5;
    }

    path.red {
      fill: none;
      stroke-width: 2px;
      stroke: red;
    }

    path.red-dot {
      fill: none;
      stroke-width: 1px;
      stroke: red;
      border-style: dotted;
      stroke-dasharray: 5;
    }

    path.black-dot {
      fill: none;
      stroke-width: 1px;
      stroke: black;
      border-style: dotted;
      stroke-dasharray: 5;
    }

    line.gridline {
      fill: none;
      stroke-width: 1px;
      stroke: black;
      border-style: dotted;
      stroke-dasharray: 5;
    }

    div.wykresy {
      margin-left: 0px;
      padding-left: 0px;

    }

    .sumy {}



    a.metoda:link,
    a.metoda:visited {

      color: gray;


    }
  </style>
</head>

<body>



  <div class="container" id="idcontainer">
    <!-- Image and text -->
    <div class="row">
      <div class="col">
        <nav class="navbar navbar-light bg-light">
          <h1>Oblicz WPS</h1>
          {% if current_user.is_authenticated %}
          <a href="{{ url_for('admin_bp.logout') }}" class="navbar-item">
            {{current_user.name}} - Wyloguj
          </a>
          {% endif %}
        </nav>
      </div>
    </div>
    <div class="row top-buffer">
      <div class="col">
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        <div class="alert alert-warning" role="alert">
          {{error}}
        </div>
        {% endif %}
        {% endwith %}
      </div>
    </div>

    <div class="row top-buffer">

      <div class="col-lg-4">
        <nav class="navbar" style="background-color: #e3f2fd;">
          <div id="wibor3mnav">a</div>
        </nav>
      </div>
      <div class="col-lg-4">
        <nav class="navbar" style="background-color: #e3f2fd;">
          <div id="wibor6mnav"></div>
        </nav>
      </div>
      {% if current_user.is_authenticated and (current_user.name=='admin' or current_user.name=='kancelaria_admin') %}
      <div class="col-lg-4">

        <nav class="navbar" style="background-color: #e3f2fd; display: flex; justify-content: flex-end">

          <a href="{{ url_for('bp.wibor') }}" class="navbar-item">
            Aktualizacja wiboru
          </a>

        </nav>
      </div>
      {% endif %}

    </div>
    <form id="upload-form" action="{{ url_for('bp.main') }}" method="POST">

      <div class="row top-buffer">
        <div class="col-lg-3">
          <label for="idKapital1">Wartość - Transza 1.</label>
          <input type="text" class="form-control" placeholder="Ile?" name="kapital1" id="idKapital1">
        </div>
        <div class="col-lg-3">
          <label for="idData1">Data uruchomienia 1.</label>
          <input type="text" class="form-control" placeholder="DD/MM/YYYY" name="dataStart1" id="idData1">
        </div>
        <div class="col-lg-3">
          <label for="idUmowa">Data podpisania umowy</label>
          <input type="text" class="form-control" placeholder="DD/MM/YYYY" name="dataUmowa" id="idUmowa">
        </div>
        <div class="col-lg-3">
          <label for="idOkresy">Liczba rat miesięcznych</label>
          <input type="text" class="form-control" placeholder="okresy" name="okresy" id="idOkresy">
        </div>
      </div>
      <div class="row top-buffer">
        <div class="col-lg-3">
          <label for="idMarza">Marża</label>
          <input type="text" class="form-control" placeholder="marża" name="marza" id="idMarza">
        </div>
        <div class="col-lg-3">
          <label class="mr-sm-2" for="idRodzajWiboru">Rodzaj Wiboru</label>
          <select class="custom-select mr-sm-2" id="idRodzajWiboru" name="rodzajWiboru">
            <option value="3M" selected>Wibor 3M</option>
            <option value="6M">Wibor 6M</option>
          </select>
        </div>
        <div class="col-lg-3">
          <label class="mr-sm-2" for="idRodzajRat">Rodzaj rat</label>
          <select class="custom-select mr-sm-2" id="idRodzajRat" name="rodzajRat">
            <option value="stale" selected>stałe</option>
            <option value="malejace">malejące</option>
          </select>
        </div>
        <div class="col-lg-3">
          <label for="idDataZamrozenia">Data zamrożenia Wiboru</label>
          <input type="text" class="form-control" placeholder="DD/MM/YYYY" name="dataZamrozenia" id="idDataZamrozenia">
        </div>
      </div>
      <div class="row top-buffer">
        <div class="col-lg-2">
          <a class="btn btn-large btn-success" id="idGuzikDodajTransze" href="">Dodaj transze</a>
        </div>
        <div class="col-lg-10">
          <a class="btn btn-large btn-warning" id="idGuzikUsunTransze" href="">Usuń ostatnią transze</a>
        </div>
      </div>
      <div id="hehe"></div>

 
      <div class="text-right top-buffer">

        <button type="submit" class="btn btn-primary">Oblicz</button>
      </div>




    </form>


    {% if fin_data %}

    <div class="row top-buffer">
      <div class="col">

        <div class="card text-bg-primary">
          <div class="card-header">
            Zamrożone oprocentowanie kredytu w dniu uruchomienia kredytu
          </div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">
              <div style="float: left">(A). Marża</div>
              <div style="float: right" id="idMarzaUmowa">aa</div>
            </li>
            <li class="list-group-item">
              <div style="float: left">(B). Wibor z dnia podpisania umowy</div>
              <div style="float: right" id="idWiborUmowa">aa</div>
            </li>
            <li class="list-group-item" style="background-color: #e1e1e1">
              <div style="float: left">(A+B). Oprocentowanie w dniu podpisania umowy</div>
              <div style="float: right" id="idStopaUmowa"></div>
            </li>
            <li class="list-group-item">
              <div style="float: left">(C). Wibor w dniu zamrożenia kredytu</div>
              <div style="float: right" id="idZamrWibor"></div>
            </li>
            <li class="list-group-item" style="background-color: #e1e1e1">
              <div style="float: left">(A+C). Oprocentowanie w dniu zamrożenia kredytu</div>
              <div style="float: right" id="idZamrStopa"></div>
            </li>
          </ul>
        </div>

      </div>
    </div>

    <div class="row top-buffer">
      <div class="col">

        <div class="card text-bg-primary bg-success">
          <div class="card-header">
            Raty przed zamrożeniem wiboru
          </div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">
              <div style="float: left">Liczba rat</div>
              <div style="float: right" id="idIloscRatPrzed">aa</div>
            </li>
            <li class="list-group-item" style="background-color: #ceffa8">
              <div style="float: left" class="sumy">(A). Suma rat - marża + zmienny wibor</div>
              <div style="float: right" id="suma_rat_A" class="sumy"></div>
            </li>
            <li class="list-group-item">
              <div style="float: left"> &emsp;&emsp;&emsp;&#x2022;&ensp;kapitał</div>
              <div style="float: right" id="suma_rat_A_kapital">aa</div>
            </li>
            <li class="list-group-item">
              <div style="float: left"> &emsp;&emsp;&emsp;&#x2022;&ensp;odsetki marża</div>
              <div style="float: right" id="suma_rat_A_marza">aa</div>
            </li>
            <li class="list-group-item">
              <div style="float: left"> &emsp;&emsp;&emsp;&#x2022;&ensp;odsetki wibor</div>
              <div style="float: right" id="suma_rat_A_wibor">aa</div>
            </li>
            <li class="list-group-item" style="background-color: #ceffa8">
              <div style="float: left">Saldo kredytu (zmienny wibor)</div>
              <div style="float: right" id="idSaldoPrzed"></div>
            </li>
            <li class="list-group-item" style="background-color: #ceffa8">
              <div style="float: left" class="sumy">(B). Suma rat - oprocentowanie z dnia podpisania umowy</div>
              <div style="float: right" id="suma_rat2_A" class="sumy">aa</div>
            </li>
            <li class="list-group-item">
              <div style="float: left"> &emsp;&emsp;&emsp;&#x2022;&ensp;kapitał</div>
              <div style="float: right" id="suma_rat2_A_kapital">aa</div>
            </li>
            <li class="list-group-item">
              <div style="float: left"> &emsp;&emsp;&emsp;&#x2022;&ensp;odsetki marża</div>
              <div style="float: right" id="suma_rat2_A_marza">aa</div>
            </li>
            <li class="list-group-item">
              <div style="float: left"> &emsp;&emsp;&emsp;&#x2022;&ensp;odsetki wibor</div>
              <div style="float: right" id="suma_rat2_A_wibor">aa</div>
            </li>
            <li class="list-group-item" style="background-color: #ceffa8">
              <div style="float: left">(A - B). Do zwrotu</div>
              <div style="float: right" id="roznica_A"></div>
            </li>
          </ul>
        </div>

      </div>
    </div>

    <div class="row top-buffer">
      <div class="col">

        <div class="card text-bg-primary bg-warning">
          <div class="card-header">
            Raty po zamrożeniu wiboru
          </div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">
              <div style="float: left">Liczba rat</div>
              <div style="float: right" id="idIloscRatPo">aa</div>
            </li>
            <li class="list-group-item" style="background-color: #ffe4ad">
              <div style="float: left" class="sumy">(A). Suma rat - marża + zamrożony wibor</div>
              <div style="float: right" id="suma_rat_B" class="sumy">aa</div>
            </li>
            <li class="list-group-item">
              <div style="float: left"> &emsp;&emsp;&emsp;&#x2022;&ensp;kapitał</div>
              <div style="float: right" id="suma_rat_B_kapital">aa</div>
            </li>
            <li class="list-group-item">
              <div style="float: left"> &emsp;&emsp;&emsp;&#x2022;&ensp;odsetki marża</div>
              <div style="float: right" id="suma_rat_B_marza">aa</div>
            </li>
            <li class="list-group-item">
              <div style="float: left"> &emsp;&emsp;&emsp;&#x2022;&ensp;odsetki wibor</div>
              <div style="float: right" id="suma_rat_B_wibor">aa</div>
            </li>
            <li class="list-group-item" style="background-color: #ffe4ad">
              <div style="float: left" class="sumy">(B). Suma rat - oprocentowanie z dnia podpisania umowy</div>
              <div style="float: right" id="suma_rat2_B" class="sumy">aa</div>
            </li>
            <li class="list-group-item">
              <div style="float: left"> &emsp;&emsp;&emsp;&#x2022;&ensp;kapitał</div>
              <div style="float: right" id="suma_rat2_B_kapital">aa</div>
            </li>
            <li class="list-group-item">
              <div style="float: left"> &emsp;&emsp;&emsp;&#x2022;&ensp;odsetki marża</div>
              <div style="float: right" id="suma_rat2_B_marza">aa</div>
            </li>
            <li class="list-group-item">
              <div style="float: left"> &emsp;&emsp;&emsp;&#x2022;&ensp;odsetki wibor</div>
              <div style="float: right" id="suma_rat2_B_wibor">aa</div>
            </li>
            <li class="list-group-item" style="background-color: #ffe4ad">
              <div style="float: left">(A - B). Do zwrotu</div>
              <div style="float: right" id="roznica_B"></div>
            </li>
          </ul>
        </div>

      </div>
    </div>

    <div class="row top-buffer">
      <div class="col">
        <div class="card text-bg-primary bg-primary">
          <div class="card-header">
            Raty wszystkie
          </div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">
              <div style="float: left">Liczba rat</div>
              <div style="float: right" id="idIloscRatWszystkie">aa</div>
            </li>
            <li class="list-group-item" style="background-color: #badfff">
              <div style="float: left" class="sumy">(A). Suma rat - marża + wibor (zmienny i zamrożony)</div>
              <div style="float: right" id="suma_rat" class="sumy">aa</div>
            </li>
            <li class="list-group-item">
              <div style="float: left"> &emsp;&emsp;&emsp;&#x2022;&ensp;kapitał</div>
              <div style="float: right" id="suma_rat_kapital">aa</div>
            </li>
            <li class="list-group-item">
              <div style="float: left"> &emsp;&emsp;&emsp;&#x2022;&ensp;odsetki marża</div>
              <div style="float: right" id="suma_rat_marza">aa</div>
            </li>
            <li class="list-group-item">
              <div style="float: left"> &emsp;&emsp;&emsp;&#x2022;&ensp;odsetki wibor</div>
              <div style="float: right" id="suma_rat_wibor">aa</div>
            </li>
            <li class="list-group-item" style="background-color: #badfff">
              <div style="float: left" class="sumy">(B). Suma rat - oprocentowanie z dnia podpisania umowy</div>
              <div style="float: right" id="suma_rat2" class="sumy">aa</div>
            </li>
            <li class="list-group-item">
              <div style="float: left"> &emsp;&emsp;&emsp;&#x2022;&ensp;kapitał</div>
              <div style="float: right" id="suma_rat2_kapital">aa</div>
            </li>
            <li class="list-group-item">
              <div style="float: left"> &emsp;&emsp;&emsp;&#x2022;&ensp;odsetki marża</div>
              <div style="float: right" id="suma_rat2_marza">aa</div>
            </li>
            <li class="list-group-item">
              <div style="float: left"> &emsp;&emsp;&emsp;&#x2022;&ensp;odsetki wibor</div>
              <div style="float: right" id="suma_rat2_wibor">aa</div>
            </li>
            <li class="list-group-item" style="background-color: #badfff">
              <div style="float: left">(A - B). Do zwrotu</div>
              <div style="float: right" id="roznica"></div>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="row top-buffer">
      <div class="col-lg-10">
        <a class="btn btn-large btn-success" id="idGuzikPlik" href="">Pobierz plik .word</a>
      </div>
      <div class="col-lg-10">
        <div id="idPlikGenerowany"></div>
      </div>
    </div>
    <div class="row top-buffer">
      <div class="col-lg-4">
        <a class="btn btn-large btn-success" id="idGuzikPodsumowanie" href="">Zobacz podsumowanie</a>
      </div>
    </div>
    <div class="row top-buffer">
      <div class="col">
        <div class="col-lg-12 wykresy" id="wykres_kapital"></div>
      </div>
    </div>
    <div class="row top-buffer">
      <div class="col">
        <div class="col-lg-12 wykresy" id="wykres_raty"></div>
      </div>
    </div>
    <div class="row top-buffer">
      <div class="col">
        <div class="col-lg-12 wykresy" >
          <figure>
            <figcaption>Rys. Porównanie całkowitej kwoty zapłaconych odsetek z tytułu wiboru w przypadkach gdy a) gdy wibor jest w wysokości z dnia podpisania umowy oraz b) gdy wibor jest zmienny</figcaption>
            <div id="wykres_odsetki"></div>
            
        </figure>
        </div>
      </div>
    </div>
    <div class="row top-buffer">
      <div class="col">
        <div class="col-lg-12 wykresy" >
          <figure>
            <figcaption>Rys.2</figcaption>
            <div id="wykres_bars"></div>
        </figure>
        </div>
      </div>
    </div>

    {% endif %}

    <div class="row top-buffer">
      <div class="col">
        <nav class="navbar navbar-light bg-light">
          <span class="navbar-text">
            2023
          </span>
          <span class="navbar-text">
            @
          </span>
          <span><a href="{{ url_for('bp.opis') }}" class="metoda">Opis metody</a></span>
        </nav>
      </div>
    </div>
  </div>


    <script type="text/javascript">


      var tech_data = JSON.parse('{{tech_data|tojson|safe}}');

      console.log(tech_data)

      document.getElementById('wibor3mnav').innerHTML = "Wibor 3M do: " + String(tech_data["max_day_wibor3m"]);
      document.getElementById('wibor6mnav').innerHTML = "Wibor 6M do: " + String(tech_data["max_day_wibor6m"]);

      document.getElementById('idGuzikUsunTransze').style.display = 'none';


      if (tech_data['form_data']) {
        var dane_formularza = tech_data['form_data'];
        document.getElementById("idKapital1").value = String(dane_formularza["kapital1"]);
        document.getElementById("idData1").value = String(dane_formularza["dataStart1"]);
        document.getElementById("idUmowa").value = String(dane_formularza["dataUmowa"]);
        document.getElementById("idOkresy").value = String(dane_formularza["okresy"]);
        document.getElementById("idMarza").value = String(dane_formularza["marza"]);
        document.getElementById("idDataZamrozenia").value = String(dane_formularza["dataZamrozenia"]);
        document.getElementById("idRodzajRat").value = String(dane_formularza["rodzajRat"]);
        document.getElementById("idRodzajWiboru").value = String(dane_formularza["rodzajWiboru"]);


        var licznik = 2;
        while ('kapital'+String(licznik) in dane_formularza) {

  
          dodajTransze(licznik);
          document.getElementById("idKapital"+String(licznik)).value = String(dane_formularza["kapital"+String(licznik)]);
          document.getElementById("idData"+String(licznik)).value = String(dane_formularza["dataStart"+String(licznik)]);

          document.getElementById('idGuzikUsunTransze').style.display = 'inline-block';

          licznik = licznik + 1;
        }

      }

      function dodajTransze(nrTransza) {



        var container = document.getElementById('hehe');

        const nrTranszy = nrTransza;



        const node2 = `<div class="row top-buffer transza">
          <div class="col-lg-3">
            <label for="idKapital${nrTranszy}">Wartość - Transza ${nrTranszy}.</label>
            <input type="text" class="form-control" placeholder="Ile?" name="kapital${nrTranszy}" id="idKapital${nrTranszy}">
          </div>
          <div class="col-lg-3">
            <label for="idData${nrTranszy}">Data uruchomienia ${nrTranszy}.</label>
            <input type="text" class="form-control" placeholder="DD/MM/YYYY" name="dataStart${nrTranszy}" id="idData${nrTranszy}">
          </div>
        </div>`;


      const tempd2 = document.createElement('div');
        tempd2.innerHTML = node2;

      // Get the actual element from the container
      const element2 = tempd2.firstChild;
      
        
        container.appendChild(element2);

        
      }


      document.getElementById('idGuzikDodajTransze').addEventListener('click', function (event) {
        event.preventDefault();


        const elements = document.querySelectorAll('.transza');
        const count = elements.length;

        const nrTransza = count+2;


        
        if (count < 9) {

        
   
        dodajTransze(nrTransza);
          

      }

      

      // Make the element visible again
      document.getElementById('idGuzikUsunTransze').style.display = 'inline-block';


      });


      document.getElementById('idGuzikUsunTransze').addEventListener('click', function (event) {
        event.preventDefault();

        var container = document.getElementById('hehe');

        const elements = document.querySelectorAll('.transza');
        const count = elements.length;




        const nrTransza = count+1;

        if (nrTransza>1) {

        




        const idnr = 'idKapital'+String(nrTransza);


        const divToRemove = document.getElementById(idnr);

        const parentElement = divToRemove.parentNode.parentNode;

        container.removeChild(parentElement); 

        }

        if (nrTransza<=2) {
        this.style.display = 'none';
        }
        

      });

      
    </script>


    {% if fin_data %}
    <script type="text/javascript">

      var fin_data = JSON.parse('{{fin_data | tojson|safe}}');
      var data_zamrozenia_str = String(fin_data['data_zamrozenia'])
      var kredyt_dane = fin_data['dane']

      console.log(fin_data)

      const parseDzien = d3.timeParse("%Y-%m-%d")
      const data_zamrozenia = d3.timeParse("%d/%m/%Y")(data_zamrozenia_str)

      kredyt_dane_do_zamr = kredyt_dane['raty'].filter(function (d) { return parseDzien(d['dzien']) <= data_zamrozenia })

      console.log(kredyt_dane_do_zamr.length)

      var ilosc_rat_przed = 0
      if (typeof kredyt_dane_do_zamr !== 'undefined' && kredyt_dane_do_zamr.length > 0) {
        // the array is defined and has at least one element
        ilosc_rat_przed = d3.max(kredyt_dane_do_zamr, d => d.nr_raty)
      }
      else {


      }

      ilosc_rat_wszystkie = d3.max(kredyt_dane['raty'], d => d.nr_raty)
      ilosc_rat_po = ilosc_rat_wszystkie - ilosc_rat_przed

      suma_rat = d3.sum(kredyt_dane['raty'], d => d.rata)

      suma_rat_kapital = d3.sum(kredyt_dane['raty'], d => d.kapital)
      suma_rat_marza = d3.sum(kredyt_dane['raty'], d => d.odsetki_marza)
      suma_rat_wibor = d3.sum(kredyt_dane['raty'], d => d.odsetki_wibor)




      suma_rat_A = d3.sum(kredyt_dane_do_zamr, d => d.rata)

      suma_rat_A_kapital = d3.sum(kredyt_dane_do_zamr, d => d.kapital)
      suma_rat_A_marza = d3.sum(kredyt_dane_do_zamr, d => d.odsetki_marza)
      suma_rat_A_wibor = d3.sum(kredyt_dane_do_zamr, d => d.odsetki_wibor)

      var kredyt_dane2 = fin_data['dane2']
      kredyt_dane_do_zamr2 = kredyt_dane2['raty'].filter(function (d) { return parseDzien(d['dzien']) <= data_zamrozenia })

      suma_rat2_kapital = d3.sum(kredyt_dane2['raty'], d => d.kapital)
      suma_rat2_marza = d3.sum(kredyt_dane2['raty'], d => d.odsetki_marza)
      suma_rat2_wibor = d3.sum(kredyt_dane2['raty'], d => d.odsetki_wibor)

      suma_rat2 = d3.sum(kredyt_dane2['raty'], d => d.rata)
      suma_rat2_A = d3.sum(kredyt_dane_do_zamr2, d => d.rata)

      suma_rat2_A_kapital = d3.sum(kredyt_dane_do_zamr2, d => d.kapital)
      suma_rat2_A_marza = d3.sum(kredyt_dane_do_zamr2, d => d.odsetki_marza)
      suma_rat2_A_wibor = d3.sum(kredyt_dane_do_zamr2, d => d.odsetki_wibor)

      var do_zwrotu_przed = suma_rat_A - suma_rat2_A

      suma_rat_B = suma_rat - suma_rat_A


      suma_rat_B_kapital = suma_rat_kapital - suma_rat_A_kapital
      suma_rat_B_marza = suma_rat_marza - suma_rat_A_marza
      suma_rat_B_wibor = suma_rat_wibor - suma_rat_A_wibor

      suma_rat2_B_kapital = suma_rat2_kapital - suma_rat2_A_kapital
      suma_rat2_B_marza = suma_rat2_marza - suma_rat2_A_marza
      suma_rat2_B_wibor = suma_rat2_wibor - suma_rat2_A_wibor

      suma_rat2_B = suma_rat2 - suma_rat2_A

      zloty = function (d) { return d3.format(",.2f")(d) + " zł"; }




      d3.select("#idMarzaUmowa").text(dane_formularza["marza"] + "%")
      d3.select("#idWiborUmowa").text(fin_data['wibor_start'] + "%")
      d3.select("#idStopaUmowa").text(fin_data['stala_stopa_uruch'] + "%")
      d3.select("#idZamrWibor").text(fin_data['wibor_zamrozony'] + "%")

      suma_zamr = parseFloat(dane_formularza["marza"]) + parseFloat(fin_data['wibor_zamrozony'])

      kapital_do_splaty_po_zamr = d3.min(kredyt_dane_do_zamr, function (d) { return d.K_po; });

      kapital_do_splaty_po_zamr_stala_stopa = d3.min(kredyt_dane_do_zamr2, function (d) { return d.K_po; });


      d3.select("#idZamrStopa").text(Math.round(suma_zamr * 100) / 100 + "%")

      d3.select("#idIloscRatPrzed").text(ilosc_rat_przed + " / " + ilosc_rat_wszystkie)
      d3.select("#suma_rat_A").text(zloty(suma_rat_A))
      d3.select("#suma_rat2_A").text(zloty(suma_rat2_A))
      d3.select("#suma_rat_A_kapital").text(zloty(suma_rat_A_kapital))
      d3.select("#suma_rat_A_marza").text(zloty(suma_rat_A_marza))
      d3.select("#suma_rat_A_wibor").text(zloty(suma_rat_A_wibor))
      d3.select("#suma_rat2_A_kapital").text(zloty(suma_rat2_A_kapital))
      d3.select("#suma_rat2_A_marza").text(zloty(suma_rat2_A_marza))
      d3.select("#suma_rat2_A_wibor").text(zloty(suma_rat2_A_wibor))
      d3.select("#roznica_A").text(zloty(do_zwrotu_przed))

      d3.select("#idSaldoPrzed").text(zloty(kapital_do_splaty_po_zamr))
      d3.select("#idSaldoPrzedStala").text(zloty(kapital_do_splaty_po_zamr_stala_stopa))


      d3.select("#idIloscRatPo").text(ilosc_rat_po + " / " + ilosc_rat_wszystkie)
      d3.select("#suma_rat_B").text(zloty(suma_rat_B))
      d3.select("#suma_rat_B_kapital").text(zloty(suma_rat_B_kapital))
      d3.select("#suma_rat_B_marza").text(zloty(suma_rat_B_marza))
      d3.select("#suma_rat_B_wibor").text(zloty(suma_rat_B_wibor))
      d3.select("#suma_rat2_B").text(zloty(suma_rat2_B))
      d3.select("#suma_rat2_B_kapital").text(zloty(suma_rat2_B_kapital))
      d3.select("#suma_rat2_B_marza").text(zloty(suma_rat2_B_marza))
      d3.select("#suma_rat2_B_wibor").text(zloty(suma_rat2_B_wibor))
      d3.select("#roznica_B").text(zloty(suma_rat_B - suma_rat2_B))

      d3.select("#idIloscRatWszystkie").text(ilosc_rat_wszystkie)
      d3.select("#suma_rat").text(zloty(suma_rat))
      d3.select("#suma_rat_kapital").text(zloty(suma_rat_kapital))
      d3.select("#suma_rat_marza").text(zloty(suma_rat_marza))
      d3.select("#suma_rat_wibor").text(zloty(suma_rat_wibor))
      d3.select("#suma_rat2").text(zloty(suma_rat2))
      d3.select("#suma_rat2_kapital").text(zloty(suma_rat2_kapital))
      d3.select("#suma_rat2_marza").text(zloty(suma_rat2_marza))
      d3.select("#suma_rat2_wibor").text(zloty(suma_rat2_wibor))
      d3.select("#roznica").text(zloty(suma_rat - suma_rat2))



      //Call our resize function if the window size is changed.

      document.getElementById('idGuzikPlik').addEventListener('click', function (event) {
        event.preventDefault(); // To prevent following the link (optional)
        d3.select("#idPlikGenerowany").text("Plik jest generowany, może to potrwać kilkanaście sekund.")
        d3.select("#idGuzikPlik").attr("class", "btn btn-large btn-success disabled")
        const room_url = "{{ url_for('bp.get_doc') }}";
        fetch(room_url, {
          "method": "POST",
          "headers": { "Content-Type": "application/json" },
          "body": JSON.stringify({
            'tech_data': tech_data,
            'fin_data': fin_data,
            'do_zwrotu_przed': zloty(do_zwrotu_przed),
            'kapital_do_splaty_po_zamr': zloty(kapital_do_splaty_po_zamr),
            'svg_dane1': new XMLSerializer().serializeToString(d3.select("#svgodsetki").node())
          }),
        }).then(res => {
          return res.blob();
        }).then(blob => {
          download(blob);
          d3.select("#idPlikGenerowany").text("Plik został wygenerowany.")
          d3.select("#idGuzikPlik").attr("class", "btn btn-large btn-success")
        }).catch(err => console.log(err));

      });

      document.getElementById('idGuzikPodsumowanie').addEventListener('click', function (event) {
        event.preventDefault();
        var data = { name: "John", age: 30 };
        var form = document.createElement('form');
        form.setAttribute('method', 'post');
        form.setAttribute('action', "{{ url_for('bp.podsumowanie') }}");
        form.style.display = 'hidden';
        var input = document.createElement("input");
        input.setAttribute("type", "hidden");
        input.setAttribute("name", "tech_data");
        input.setAttribute("value", JSON.stringify(fin_data));
        form.appendChild(input);
        document.body.appendChild(form)
        form.submit();
      });



    </script>

    <script src="{{ url_for('static', filename='chartslib/drawChart.js') }}" type="text/javascript"></script>


    {% endif %}

</body>

</html>