{% extends 'base_rrso.html' %}

{% block content %}


<div id="rysunek"></div>


<script type="module">

import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";

// get full width of window

// Declare the chart dimensions and margins.
const width = window.innerWidth;;
const height = 400;
const marginTop = 20;
const marginRight = 20;
const marginBottom = 30;
const marginLeft = 40;

// Declare the x (horizontal position) scale.

    // read points from flask variable
    var points = JSON.parse('{{points|safe}}');

    console.log(points);

    // find max of dzien in points
    var max_dzien = d3.max(points, function(d) { return d.dzien; });
    var min_dzien = d3.min(points, function(d) { return d.dzien; });

    var max_y = d3.max(points, function(d) { return d.y; });
    var min_y = d3.min(points, function(d) { return d.y; });

const x = d3.scaleUtc()
    .domain([new Date(min_dzien), new Date(max_dzien)])
    .range([marginLeft, width - marginRight]);

// Declare the y (vertical position) scale.
const y = d3.scaleLinear()
    .domain([min_y, max_y])
    .range([height - marginBottom, marginTop]);

// Create the SVG container.
const svg = d3.create("svg")
    .attr("width", width)
    .attr("height", height);

  // Add the x-axis.
  svg.append("g")
      .attr("transform", `translate(0,${height - marginBottom})`)
      .call(d3.axisBottom(x));





// convert point.dzien as datetime


const gen = d3.line()
    .x((p) => x(new Date(p.dzien)) )
    .y((p) => y(p.y) )
    .curve(d3.curveStepBefore);

// set background color to svg

    svg
  .append("path") 
  .attr("d", gen(points)) 
  .attr("fill", "none") 
  .attr("stroke", "green"); 

  svg.style("background-color", "rgb(220,180,255)");


// Append the SVG element.
rysunek.append(svg.node());

</script>
{% endblock %}